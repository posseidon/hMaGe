<div class="row">
  <%= image_tag @map.image.url(:medium) %>
</div>
<div class="row">
  <div class="img-overlay">
    <img id="image" src="/hungary_map.jpg" class="img-responsive img-rounded" alt="Responsive image">
    <div id="grid-source" class="grid-overlay"></div>
  </div>
</div>
<br/>
<div class="row">
  <%= render 'map_location' %>
</div>
<div class="row">
  <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li>
              <button type="button" class="btn btn-default btn-sm navbar-btn" value="polygon" onclick="toggleControl(this);">
                <i class="glyphicon glyphicon-edit"></i>
                Polygon
              </button>
            </li>
            <li>
              <button type="button" class="btn btn-default btn-sm navbar-btn" value="box" onclick="toggleControl(this);">
                <i class="glyphicon glyphicon-stop"></i>
                Rectangle
              </button>
            </li>
            <li>
              <button type="button" class="btn btn-default btn-sm navbar-btn" value="edit" onclick="toggleControl(this);">
                <i class="glyphicon glyphicon-wrench"></i>
                Edit
              </button>
            </li>
            <li>
              <button type="button" class="btn btn-default btn-sm navbar-btn" value="select" onclick="toggleControl(this);">
                <i class="glyphicon glyphicon-hand-up"></i>
                Select
              </button>
            </li>
            <li>
              <button type="button" class="btn btn-default btn-sm navbar-btn" value="nav" onclick="toggleControl(this);">
                <i class="glyphicon glyphicon-screenshot"></i>
                Move
              </button>
            </li>
          </ul>
          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Label #1">
            </div>
            <button type="submit" class="btn btn-default btn-sm">
              <i class="glyphicon glyphicon-ok-sign"></i>
              Save
            </button>
          </form>
          <ul class="nav navbar-nav" role="menu">
            <li>
              <button type="button" class="btn btn-default navbar-btn btn-sm" value="nav" onclick="toggleControl(this);">
                <i class="glyphicon glyphicon-minus-sign"></i>
                Delete
              </button>
            </li>
          </ul>
        </div>
    </div>
  </nav>
</div>

<script type="text/javascript">
$(document).ready(function(){
var lastClicked;
var grid = clickableGrid(2,2,function(el,row,col,i){
    console.log("You clicked on element:",el);
    console.log("You clicked on row:",row);
    console.log("You clicked on col:",col);
    console.log("You clicked on item #:",i);

    el.className='clicked';
    if (lastClicked) lastClicked.className='';
    lastClicked = el;
});

$('#grid-source').append(grid);

function clickableGrid( rows, cols, callback ){
    var img = $('#image');
    var i=0;
    var grid = document.createElement('table');
    grid.id = 'grid';
    grid.className = 'table';
    for (var r=0;r<rows;++r){
        var tr = grid.appendChild(document.createElement('tr'));
        for (var c=0;c<cols;++c){
            var cell = tr.appendChild(document.createElement('td'));
            cell.width = img.width()/cols;
            cell.height = img.height()/rows;
            cell.innerHTML = ++i;
            cell.addEventListener('click',(function(el,r,c,i){
                return function(){
                    callback(el,r,c,i);
                }
            })(cell,r,c,i),false);
        }
    }
    return grid;
}
});
</script>

